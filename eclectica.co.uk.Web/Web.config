<?xml version="1.0" encoding="UTF-8"?>
<!--
  For more information on how to configure your ASP.NET application, please visit
  http://go.microsoft.com/fwlink/?LinkId=152368
  -->
<configuration>
  <configSections>
    <sectionGroup name="system.web.webPages.razor" type="System.Web.WebPages.Razor.Configuration.RazorWebSectionGroup, System.Web.WebPages.Razor, Version=1.0.0.0, Culture=neutral, PublicKeyToken=31BF3856AD364E35">
      <section name="host" type="System.Web.WebPages.Razor.Configuration.HostSection, System.Web.WebPages.Razor, Version=1.0.0.0, Culture=neutral, PublicKeyToken=31BF3856AD364E35" requirePermission="false" />
      <section name="pages" type="System.Web.WebPages.Razor.Configuration.RazorPagesSection, System.Web.WebPages.Razor, Version=1.0.0.0, Culture=neutral, PublicKeyToken=31BF3856AD364E35" requirePermission="false" />
    </sectionGroup>
    <sectionGroup name="elmah">
      <section name="security" requirePermission="false" type="Elmah.SecuritySectionHandler, Elmah" />
      <section name="errorLog" requirePermission="false" type="Elmah.ErrorLogSectionHandler, Elmah" />
      <section name="errorMail" requirePermission="false" type="Elmah.ErrorMailSectionHandler, Elmah" />
      <section name="errorFilter" requirePermission="false" type="Elmah.ErrorFilterSectionHandler, Elmah" />
    </sectionGroup>
  </configSections>
  <system.web.webPages.razor>
    <host factoryType="System.Web.Mvc.MvcWebRazorHostFactory, System.Web.Mvc, Version=3.0.0.0, Culture=neutral, PublicKeyToken=31bf3856ad364e35" />
    <pages pageBaseType="System.Web.Mvc.WebViewPage">
      <namespaces>
        <add namespace="System.Web.Mvc" />
        <add namespace="System.Web.Mvc.Ajax" />
        <add namespace="System.Web.Mvc.Html" />
        <add namespace="System.Web.Routing" />
        <add namespace="System.Configuration" />
        <add namespace="eclectica.co.uk.Web.Models" />
        <add namespace="eclectica.co.uk.Web.Extensions" />
      </namespaces>
    </pages>
  </system.web.webPages.razor>
  <connectionStrings configSource="Db.config" />
  <appSettings configSource="Settings.config" />
  <system.web>
    <compilation debug="true" targetFramework="4.0">
      <assemblies>
        <add assembly="System.Web.Abstractions, Version=4.0.0.0, Culture=neutral, PublicKeyToken=31BF3856AD364E35" />
        <add assembly="System.Web.Routing, Version=4.0.0.0, Culture=neutral, PublicKeyToken=31BF3856AD364E35" />
        <add assembly="System.Web.Mvc, Version=3.0.0.0, Culture=neutral, PublicKeyToken=31bf3856ad364e35" />
        <add assembly="System.Web.Helpers, Version=1.0.0.0, Culture=neutral, PublicKeyToken=31BF3856AD364E35" />
        <add assembly="System.Web.WebPages, Version=1.0.0.0, Culture=neutral, PublicKeyToken=31BF3856AD364E35" />
      </assemblies>
    </compilation>
    <authentication configSource="Auth.config" />
    <customErrors mode="Off">
      <!-- Custom handling in Global.asax -->
    </customErrors>
    <pages>
      <namespaces>
        <add namespace="System.Web.Mvc" />
        <add namespace="System.Web.Mvc.Ajax" />
        <add namespace="System.Web.Mvc.Html" />
        <add namespace="System.Web.Routing" />
        <add namespace="System.Web.Helpers" />
        <add namespace="System.Web.WebPages" />
      </namespaces>
    </pages>
    <httpModules>
      <add name="ErrorLog" type="Elmah.ErrorLogModule, Elmah" />
      <add name="ErrorMail" type="Elmah.ErrorMailModule, Elmah" />
      <add name="ErrorFilter" type="Elmah.ErrorFilterModule, Elmah" />
    </httpModules>
    <httpHandlers>
      <add verb="POST,GET,HEAD" path="elmah.axd" type="Elmah.ErrorLogPageFactory, Elmah" />
    </httpHandlers>
  </system.web>
  <system.data>
    <DbProviderFactories>
      <add name="Microsoft SQL Server Compact Edition Client Data Provider 4.0" invariant="System.Data.SqlServerCe.4.0" description=".NET Framework Data Provider for Microsoft SQL Server Compact Edition Client 4.0" type="System.Data.SqlServerCe.SqlCeProviderFactory, System.Data.SqlServerCe, Version=4.0.0.0, Culture=neutral, PublicKeyToken=89845dcd8080cc91" />
      <remove invariant="MvcMiniProfiler.Data.ProfiledDbProvider" />
      <add name="MvcMiniProfiler.Data.ProfiledDbProvider" invariant="MvcMiniProfiler.Data.ProfiledDbProvider" description="MvcMiniProfiler.Data.ProfiledDbProvider" type="MvcMiniProfiler.Data.ProfiledDbProviderFactory, MvcMiniProfiler, Version=1.6.0.0, Culture=neutral, PublicKeyToken=b44f9351044011a3" />
      <remove invariant="System.Data.SqlServerCe.4.0" />
      <add name="Microsoft SQL Server Compact Data Provider 4.0" invariant="System.Data.SqlServerCe.4.0" description=".NET Framework Data Provider for Microsoft SQL Server Compact" type="System.Data.SqlServerCe.SqlCeProviderFactory, System.Data.SqlServerCe, Version=4.0.0.0, Culture=neutral, PublicKeyToken=89845dcd8080cc91" />
    </DbProviderFactories>
  </system.data>
  <system.webServer>
    <handlers>
      <add name="UrlRoutingModule1" path="mini-profiler*.js" verb="*" type="System.Web.Routing.UrlRoutingModule" resourceType="Unspecified" preCondition="integratedMode" />
      <add name="UrlRoutingModule2" path="mini-profiler*.css" verb="*" type="System.Web.Routing.UrlRoutingModule" resourceType="Unspecified" preCondition="integratedMode" />
      <add name="UrlRoutingModule3" path="mini-profiler*.tmpl" verb="*" type="System.Web.Routing.UrlRoutingModule" resourceType="Unspecified" preCondition="integratedMode" />
      <add name="Elmah" path="elmah.axd" verb="POST,GET,HEAD" type="Elmah.ErrorLogPageFactory, Elmah" preCondition="integratedMode" />
    </handlers>
    <rewrite>
      <rules>
        <rule name="Mobile Robots.txt" enabled="true" stopProcessing="true">
          <match url="/robots.txt" />
          <conditions logicalGrouping="MatchAll">
            <add input="{HTTP_HOST}" pattern="m.eclectica.co.uk" ignoreCase="false" />
          </conditions>
          <action type="Rewrite" url="/robots-mobile.txt" />
        </rule>
        <rule name="Enforce Canonical URL">
          <match url="/(.*?)" />
          <conditions logicalGrouping="MatchAll">
            <add input="{HTTP_HOST}" pattern="www.eclectica.co.uk" ignoreCase="false" />
          </conditions>
          <action type="Redirect" url="http\://eclectica.co.uk/{R:1}" redirectType="Permanent" />
        </rule>
        <rule name="Old Snap To Flickr 1">
          <match url="/snap/05-02-2011-1712/?" />
          <action type="Redirect" url="http://www.flickr.com/photos/markashleybell/6387795939/in/set-72157628107693771/lightbox/" redirectType="Permanent" />
        </rule>
        <rule name="Old Snap To Flickr 2">
          <match url="/snap/06-03-2011-1727/?" />
          <action type="Redirect" url="http://www.flickr.com/photos/markashleybell/6387795631/in/set-72157628107693771/lightbox/" redirectType="Permanent" />
        </rule>
        <rule name="Old Snap To Flickr 3">
          <match url="/snap/10-04-2010-1535/?" />
          <action type="Redirect" url="http://www.flickr.com/photos/markashleybell/6387795337/in/set-72157628107693771/lightbox/" redirectType="Permanent" />
        </rule>
        <rule name="Old Snap To Flickr 4">
          <match url="/snap/10-04-2010-1652/?" />
          <action type="Redirect" url="http://www.flickr.com/photos/markashleybell/6387795011/in/set-72157628107693771/lightbox/" redirectType="Permanent" />
        </rule>
        <rule name="Old Snap To Flickr 5">
          <match url="/snap/12-12-2010-1407/?" />
          <action type="Redirect" url="http://www.flickr.com/photos/markashleybell/6387794677/in/set-72157628107693771/lightbox/" redirectType="Permanent" />
        </rule>
        <rule name="Old Snap To Flickr 6">
          <match url="/snap/12-12-2010-1412/?" />
          <action type="Redirect" url="http://www.flickr.com/photos/markashleybell/6387794377/in/set-72157628107693771/lightbox/" redirectType="Permanent" />
        </rule>
        <rule name="Old Snap To Flickr 7">
          <match url="/snap/13-03-2011-2057/?" />
          <action type="Redirect" url="http://www.flickr.com/photos/markashleybell/6387794105/in/set-72157628107693771/lightbox/" redirectType="Permanent" />
        </rule>
        <rule name="Old Snap To Flickr 8">
          <match url="/snap/15-04-2010-1834/?" />
          <action type="Redirect" url="http://www.flickr.com/photos/markashleybell/6387793925/in/set-72157628107693771/lightbox/" redirectType="Permanent" />
        </rule>
        <rule name="Old Snap To Flickr 9">
          <match url="/snap/16-04-2010-1648/?" />
          <action type="Redirect" url="http://www.flickr.com/photos/markashleybell/6387793579/in/set-72157628107693771/lightbox/" redirectType="Permanent" />
        </rule>
        <rule name="Old Snap To Flickr 10">
          <match url="/snap/16-04-2010-1656/?" />
          <action type="Redirect" url="http://www.flickr.com/photos/markashleybell/6387793275/in/set-72157628107693771/lightbox/" redirectType="Permanent" />
        </rule>
        <rule name="Old Snap To Flickr 11">
          <match url="/snap/19-02-2011-1534/?" />
          <action type="Redirect" url="http://www.flickr.com/photos/markashleybell/6387792971/in/set-72157628107693771/lightbox/" redirectType="Permanent" />
        </rule>
        <rule name="Old Snap To Flickr 12">
          <match url="/snap/19-06-2010-1807/?" />
          <action type="Redirect" url="http://www.flickr.com/photos/markashleybell/6387792541/in/set-72157628107693771/lightbox/" redirectType="Permanent" />
        </rule>
        <rule name="Old Snap To Flickr 13">
          <match url="/snap/2010-04-18-1919/?" />
          <action type="Redirect" url="http://www.flickr.com/photos/markashleybell/6387792303/in/set-72157628107693771/lightbox/" redirectType="Permanent" />
        </rule>
        <rule name="Old Snap To Flickr 14">
          <match url="/snap/2011-04-22-1224/?" />
          <action type="Redirect" url="http://www.flickr.com/photos/markashleybell/6387791917/in/set-72157628107693771/lightbox/" redirectType="Permanent" />
        </rule>
        <rule name="Old Snap To Flickr 15">
          <match url="/snap/2011-05-26-2037/?" />
          <action type="Redirect" url="http://www.flickr.com/photos/markashleybell/6387791599/in/set-72157628107693771/lightbox/" redirectType="Permanent" />
        </rule>
        <rule name="Old Snap To Flickr 16">
          <match url="/snap/2011-05-26-2053/?" />
          <action type="Redirect" url="http://www.flickr.com/photos/markashleybell/6387790983/in/set-72157628107693771/lightbox/" redirectType="Permanent" />
        </rule>
        <rule name="Old Snap To Flickr17">
          <match url="/snap/2011-08-21-1435/?" />
          <action type="Redirect" url="http://www.flickr.com/photos/markashleybell/6387790679/in/set-72157628107693771/lightbox/" redirectType="Permanent" />
        </rule>
        <rule name="Old Snap To Flickr 18">
          <match url="/snap/2011-08-21-1436/?" />
          <action type="Redirect" url="http://www.flickr.com/photos/markashleybell/6387790317/in/set-72157628107693771/lightbox/" redirectType="Permanent" />
        </rule>
        <rule name="Old Snap To Flickr 19">
          <match url="/snap/2011-08-21-1500/?" />
          <action type="Redirect" url="http://www.flickr.com/photos/markashleybell/6387789971/in/set-72157628107693771/lightbox/" redirectType="Permanent" />
        </rule>
        <rule name="Old Snap To Flickr">
          <match url="/snap/21-06-2010-1313/?" />
          <action type="Redirect" url="http://www.flickr.com/photos/markashleybell/6387789663/in/set-72157628107693771/lightbox/" redirectType="Permanent" />
        </rule>
        <rule name="Old Snap To Flickr 20">
          <match url="/snap/27-03-2010-1707/?" />
          <action type="Redirect" url="http://www.flickr.com/photos/markashleybell/6387789465/in/set-72157628107693771/lightbox/" redirectType="Permanent" />
        </rule>
        <rule name="Old Snap To Flickr 21">
          <match url="/snap/29-01-2011-1225/?" />
          <action type="Redirect" url="http://www.flickr.com/photos/markashleybell/6387789133/in/set-72157628107693771/lightbox/" redirectType="Permanent" />
        </rule>
        <rule name="Old Snap To Flickr 22">
          <match url="/snap/30-08-2010-1925/?" />
          <action type="Redirect" url="http://www.flickr.com/photos/markashleybell/6387788991/in/set-72157628107693771/lightbox/" redirectType="Permanent" />
        </rule>
        <rule name="Redirect Old RSS URL">
          <match url="/rss/main/?" />
          <action type="Redirect" url="http://eclectica.co.uk/feed/main" redirectType="Permanent" />
        </rule>
        <rule name="Remove URL Trailing Slashes">
          <match url="/(.*)/$" />
          <action type="Redirect" url="http://eclectica.co.uk/{R:1}" redirectType="Permanent" />
        </rule>
        <rule name="Remove URL With Query String Trailing Slashes">
          <match url="/(.*)/(\?.*)$" />
          <action type="Redirect" url="http://eclectica.co.uk/{R:1}{R:2}" redirectType="Permanent" />
        </rule>
        <rule name="Feedburner Redirect If Request Not From Feedburner Bot">
          <match url="/feed/main" />
          <conditions logicalGrouping="MatchAll">
            <add input="{HTTP_USER_AGENT}" pattern="(?!feedburner).*" ignoreCase="false" />
          </conditions>
          <action type="Redirect" url="http://feeds.feedburner.com/eclecticablog" redirectType="Permanent" />
        </rule>
        <rule name="Redirect Favicon Requests" enabled="true">
          <match url="/favicon.ico" />
          <action type="Redirect" url="http://eclectica.co.uk/content/img/site/favicon.ico" redirectType="Found" />
        </rule>
        <rule name="Redirect Old Image URLs 1">
          <match url="/img/lib/original/(\d+).(jpg|gif|png)" />
          <conditions logicalGrouping="MatchAll">
            <add input="{HTTP_HOST}" pattern="s1.eclectica.co.uk" ignoreCase="false" />
          </conditions>
          <action type="Redirect" url="http://s1.eclectica.co.uk/content/img/lib/std/{R:1}.{R:2}" redirectType="Permanent" />
        </rule>
        <rule name="Redirect Old Image URLs 2">
          <match url="/img/lib/(std|cms|crop|drop)/(\d+).(jpg|gif|png)" />
          <action type="Redirect" url="http://s1.eclectica.co.uk/content/img/lib/{R:1}/{R:2}.{R:3}" redirectType="Permanent" />
        </rule>
        <rule name="Redirect Old Image URLs 3">
          <match url="/img/lib/original/(\d+).(jpg|gif|png)" />
          <conditions logicalGrouping="MatchAll">
            <add input="{HTTP_HOST}" pattern="s2.eclectica.co.uk" ignoreCase="false" />
          </conditions>
          <action type="Redirect" url="http://s2.eclectica.co.uk/content/img/lib/std/{R:1}.{R:2}" redirectType="Permanent" />
        </rule>
        <rule name="Redirect Old Image URLs 4">
          <match url="/img/lib/(std|cms|crop|drop)/(\d+).(jpg|gif|png)" />
          <action type="Redirect" url="http://s2.eclectica.co.uk/content/img/lib/{R:1}/{R:2}.{R:3}" redirectType="Permanent" />
        </rule>
        <rule name="Redirect Archive Url Trailing Slash">
          <match url="/(\d{4})/?(\?.*)?" />
          <action type="Redirect" url="http://eclectica.co.uk/{R:1}/01{R:2}" redirectType="Permanent" />
        </rule>
        <rule name="Redirect Old Single-Digit Archive Url">
          <match url="/(\d{4})/(\d{1})/?(\?.*)?" />
          <action type="Redirect" url="http://eclectica.co.uk/{R:1}/0{R:2}{R:3}" redirectType="Permanent" />
        </rule>
        <rule name="Kill Request For Old Post URL Scheme 1" stopProcessing="true">
          <match url="/(\d{4})/(\d{2})/(\d{1,2})/?(\?.*)?" />
          <action type="Redirect" url="http://eclectica.co.uk/notfound" redirectType="Found" />
        </rule>
        <rule name="Kill Request For Old Post URL Scheme 2" stopProcessing="true">
          <match url="/(\d{4})/(\d{2})/(\d{1,2})/(\d{4})/?(\?.*)?" />
          <action type="Redirect" url="http://eclectica.co.uk/notfound" redirectType="Found" />
        </rule>
        <rule name="Kill Request For Old Post URL Scheme 3">
          <match url="/(\d{4})/(\d{2})/(\d{2})/([^?/]+)/?(\?.*)?" />
          <action type="Redirect" url="http://eclectica.co.uk/{R:4}{R:5}" redirectType="Permanent" />
        </rule>
        <rule name="Append Mobile Flag When Under Mobile Host" stopProcessing="true">
          <match url="/(.*?)" />
          <conditions logicalGrouping="MatchAll">
            <add input="{HTTP_HOST}" pattern="m.eclectica.co.uk" ignoreCase="false" />
          </conditions>
          <action type="Rewrite" url="/{R:1}?mobile=true" appendQueryString="false" />
        </rule>
      </rules>
    </rewrite>
    <validation validateIntegratedModeConfiguration="false" />
    <modules>
      <add name="ErrorLog" type="Elmah.ErrorLogModule, Elmah" preCondition="managedHandler" />
      <add name="ErrorMail" type="Elmah.ErrorMailModule, Elmah" preCondition="managedHandler" />
      <add name="ErrorFilter" type="Elmah.ErrorFilterModule, Elmah" preCondition="managedHandler" />
    </modules>
  </system.webServer>
  <elmah>
    <errorLog type="Elmah.SqlServerCompactErrorLog, Elmah" connectionStringName="elmah-sqlservercompact" />
  </elmah>
  <location path="elmah.axd">
    <system.web>
      <authorization>
        <deny users="?" />
      </authorization>
    </system.web>
  </location>
</configuration>